# Gemini Station 项目记忆 (GEMINI.md)

## 核心架构设计

### 1. TODO 任务系统 (招牌功能)
*   **原则**：数据跟着项目走，完全去隐藏化，保持项目“自包含”。
*   **存储路径** (均在项目根目录下)：
    *   `gemini-todo.json`: 任务主文件。
    *   `todo-images/`: 截图存放目录。
    *   `todo-backups/`: 自动快照备份目录。
*   **交互逻辑**：
    *   **自动状态推力**：点击“注入/追加”到终端时，任务状态自动从“待办”切换至“进行中”。
    *   **截图捕获**：支持在输入框直接 `Ctrl+V` 粘贴截图，自动保存并生成本地路径引用。
    *   **多项目隔离**：系统感知终端 `cd` 动作，动态切换对应目录下的任务清单。

### 2. 会话存档 (Archive) 逻辑
*   **存储位置**：沿用 Gemini CLI 原生全局路径 `~/.gemini/tmp/<hash>/`。
*   **Hash 兼容性方案** (关键经验)：
    *   **痛点**：Windows 环境下，不同启动方式会导致同一路径计算出不同的 SHA256 Hash（受大小写、斜杠方向影响）。
    *   **解决方案**：后端计算路径的多种变体（原样、全小写、正斜杠、反斜杠组合），并聚合所有匹配 Hash 文件夹下的存档，确保记忆不丢失。

## 关键技术修复记录

### Windows PTY 兼容性
*   **指令执行**：Windows PowerShell 环境下，模拟按键需发送 `指令文本` + `20ms延迟` + `` 才能稳定触发执行。
*   **Shell 切换**：`!` 指令需单独发送，绝对不能附加回车符。

### 后端稳定性
*   **进程保护**：增加了 `uncaughtException` 监听，防止因底层终端进程意外关闭导致 Web 服务崩溃。
*   **端口清理**：在 `start.bat` 中增加了 3001 端口强制清理逻辑，确保每次启动都是最新代码。
*   **大文件支持**：`socket.io` 开启了 `maxHttpBufferSize: 1e8`，支持大图传输。

## 开发者备忘
1.  **迁移项目**：如需迁移项目，请务必连同 `gemini-todo.json` 和 `todo-images/` 一起移动。
2.  **存档不显示**：如果存档消失，优先检查终端所在的 `PATH` 是否正确，系统会自动进行多 Hash 匹配。
3.  **UI 风格**：保持“实验室/极客”风格，按钮使用毛玻璃特效与分类色彩标识。
